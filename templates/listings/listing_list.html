{% extends 'base.html' %}

{% block title %}Listings{% endblock %}
{% load static %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/listings.css' %}">
{% endblock %}

{% block content %}
<h2 class="page-title">Listings</h2>
<form method="get" class="search-form">
    <input type="text" name="q" placeholder="Search..." value="{{ query }}" class="search-input">
    <select name="category" class="search-select">
        <option value="">All Categories</option>
        {% for category in categories %}
            <option value="{{ category.id }}" {% if category_id == category.id|stringformat:'s' %}selected{% endif %}>{{ category.name }}</option>
        {% endfor %}
    </select>
    <input type="number" name="min_price" placeholder="Min Price" value="{{ min_price }}" class="search-input">
    <input type="number" name="max_price" placeholder="Max Price" value="{{ max_price }}" class="search-input">
    <button type="submit" class="btn btn-search">Search</button>
</form>

<a href="{% url 'listing_create' %}" class="btn add-listing-btn">Create Listing</a>

<div class="listings">
    {% for listing in page_obj %}
        <div class="listing-card">
            {% if listing.image %}
                <img src="{{ listing.image.url }}" alt="{{ listing.title }}" class="listing-image">
            {% endif %}
            <h3>{{ listing.title }}</h3>
            <p>{{ listing.description|truncatewords:20 }}</p>
            <p><strong>${{ listing.price }}</strong></p>
            <a href="{% url 'listing_detail' listing.slug %}" class="btn btn-details">View Details</a>
        </div>
    {% endfor %}
</div>

<div class="pagination">
    <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="?page=1" class="pagination-link">&laquo; first</a>
            <a href="?page={{ page_obj.previous_page_number }}" class="pagination-link">previous</a>
        {% endif %}

        <span class="current">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}" class="pagination-link">next</a>
            <a href="?page={{ page_obj.paginator.num_pages }}" class="pagination-link">last &raquo;</a>
        {% endif %}
    </span>
</div>
{% endblock %}
